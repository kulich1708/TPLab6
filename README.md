<h1>Решенные проблемы качества</h1>
<ul>
<li>Слишком длинная функция - process_checkout в старой версии содержала 70+ строк и совмещала валидацию, бизнес-логику и форматирование</li>
<li>Нарушение SRP (Single Responsibility Principle) - одна функция делала всё: парсинг, валидацию, расчёты, генерацию ID</li>
<li>"Магические числа" - в коде были значения (0.1, 200, 50, 0.21 и т.д.), которые брались непонятно откуда. При изменении бизнес-логики такие числа было бы тяжело найти и поменять</li>
<li>Слабая типизация - использовался any и { [key: string]: any }</li>
<li>Хрупкость кода - добавление нового купона или валюты требовало изменения большой функции</li>
<li>Дублирование кода - повторяющиеся проверки и расчёты в разных частях функции</li>
</ul>

<h1>Примененный рефакторинг</h1>

<h2>Разделение на функции</h2>
<ul>
<li>validateRequest() - валидация запроса</li>
<li>validateItem() - валидация товара</li>
<li>calculateSubtotal() - подсчёт суммы</li>
<li>calculateDiscount() - расчёт скидки</li>
<li>calculateDiscountInternal() - внутренняя логика скидок</li>
<li>calculateTax() - расчёт налога</li>
<li>generateOrderId() - генерация ID заказа</li>
<li>processCheckoutInternal() - основная логика обработки заказа</li>
<li>processCheckout() - публичный интерфейс с валидацией</li>
</ul>

<h2>Вынос констант (CONFIG)</h2>
<ul>
<li>Все "магические числа" вынесены в CONFIG объект</li>
<li>Теперь CONFIG - единственный источник истины, в котором указаны все возможные купоны, валюты, константы</li>
<li>На основе CONFIG выводятся типы</li>
</ul>

<h1>Что стало лучше после рефакторинга</h1>
<ul>
<li>Читаемость - основная функция processCheckoutInternal() теперь ~ 15 строк, вместо ~ 70</li>
<li>Поддерживаемость - чтобы добавить новый купон, нужно только добавить его в CONFIG.COUPONS</li>
<li>Тестируемость - каждую функцию можно тестировать отдельно</li>
<li>Переиспользование - функции можно использовать в других частях системы</li>
<li>Конфигурируемость - все параметры собраны в одном месте</li>
</ul>

<h1>Сравнение метрик</h1>
<ul>
<li>Основная функция сократилась с 70+ строк до ~15 строк логики</li>
<li>Повторяющийся код устранён (валидация, расчёты)</li>
<li>Уровень вложенности уменьшен</li>
<li>Общее количество строк увеличилось, зато теперь имеем огронмые преимущества для дальнейшей масштабируемости</li>
</ul>

<h1>Тестирование</h1>
<ul>
<li>Все существующие тесты продолжают проходить</li>
<li>Новые тесты писать проще (можно тестировать каждую функцию отдельно)</li>
</ul>

<h1>Итог</h1>
<ul>
<li>Каждая функция делает одну вещь и делает её хорошо</li>
<li>Конфигурация отделена от логики</li>
<li>Код стал самодокументируемым за счет четких имен и структуры</li>
<li>Монолитный, трудночитаемый код превращен в модульную, типизированную систему</li>
</ul>
